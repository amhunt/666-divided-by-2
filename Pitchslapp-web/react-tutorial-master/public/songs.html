<!DOCTYPE html>
<html lang="en-US">
<html>
  <head>
    <meta charset="utf-8">
    <title>Pitchslapp</title>
    <!-- Not present in the tutorial. Just for basic styling. -->
    <link rel="stylesheet" href="css/base.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.6.15/browser.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.5/marked.min.js"></script>
    <script src="https://cdn.firebase.com/js/client/2.4.1/firebase.js"></script>
    <script type="text/javascript" src="https://www.dropbox.com/static/api/2/dropins.js" id="dropboxjs" data-app-key="0t2k59m96bjkpw3"></script>

  </head>
  <body style="text-align: center; background-color: #F7CAC9";>
    <h1>Pitchslapp</h1>
    <div id='messagesDiv'></div>
    <input style="text-align:center" type='text' id='nameInput' placeholder='Name of Song'>
    <br>
    <input style="text-align:center" type='text' id='soloInput' placeholder='Name of Soloist'>
    <br>
    <input style="text-align:center" type='text' id='keyInput' placeholder='Key of Song'>
    <br>
    <div id='container'> </div>
    <br>
    <button type="button" id="submitButton">Submit Song</button>
    <ul id="records"></ul>
    <div id="content"></div>
    <h2><a href="index.html">Back to Groups</a>
    <script type="text/babel">
      function myFunction() {        
        alert("removed!");
      };
    var ref = new Firebase("https://popping-inferno-1963.firebaseio.com/groups/-KE2t-HbseflgtLhuV8-/songs");

      $('#submitButton').click(function (e) {
        var name = $('#nameInput').val();
        var solo = $('#soloInput').val();
        var keyVal = $('#keyInput').val();
        var id = ref.push({
          solo: solo,
          name: name,
          key: keyVal
        });
        console.log(id);
        $('#nameInput').val('');
        $('#soloInput').val('');
        $('#keyInput').val('Song Added!');
      });
      $('#keyInput').keypress(function (e) {
        if (e.keyCode == 13) {
          var name = $('#nameInput').val();
          var solo = $('#soloInput').val();
          var keyVal = $('#keyInput').val();
          var id = ref.push({
            solo: solo,
            name: name,
            key: keyVal
          });
          console.log(id);
          $('#nameInput').val('');
          $('#soloInput').val('');
          $('#keyInput').val('Song Added!');
        }
      });
      ref.on('child_added', function(snapshot) {
        var message = snapshot.val();
        displayChatMessage(message.name, message.solo, message.key, snapshot.key());
      });
      function deleteSong(deletedSong) {
        var newRef = ref.child(deletedSong);
        newRef.remove();
      }
      function displayChatMessage(name, soloist, key, id) {
        $('<div/>').text(soloist).prepend($('<em/>').html('<button id="'+id+'">Delete</button>' + '<a href=' + id + '.pdf target="_blank" style="color:black"> '+name+' ('+key+'): ')).appendTo($('#messagesDiv'));
        document.getElementById(id).onclick = function() {deleteSong(id)};
        $('#messagesDiv')[0].scrollTop = $('#messagesDiv')[0].scrollHeight;
      };
      ref.on('child_removed', function(snapshot) {  
        var deletedSong = snapshot.val().name;
        console.log("The song titled '" + deletedSong + "' has been deleted");
        $('#messagesDiv').find( ":contains('"+ deletedSong + "')" ).remove();
      });
      var options = {
        // Required. Called when a user selects an item in the Chooser.
        success: function(files) {
            alert("Here's the file link: " + files[0].link)
        },
        // Optional. Called when the user closes the dialog without selecting a file
        // and does not include any parameters.
        cancel: function() {

        },
        // Optional. "preview" (default) is a preview link to the document for sharing,
        // "direct" is an expiring link to download the contents of the file. For more
        // information about link types, see Link types below.
        linkType: "preview", // or "direct"

        // Optional. A value of false (default) limits selection to a single file, while
        // true enables multiple file selection.
        multiselect: false, // or true

        // Optional. This is a list of file extensions. If specified, the user will
        // only be able to select files with these extensions. You may also specify
        // file types, such as "video" or "images" in the list. For more information,
        // see File types below. By default, all extensions are allowed.
        extensions: ['.pdf', '.doc', '.docx'],
      };
      var button = Dropbox.createChooseButton(options);
      document.getElementById("container").appendChild(button);
    </script>
  </body>
</html>
